# 监控&告警

## 概念

**这里用户可以管理设置平台告警和消息通知。**

## 告警设置

### 概念

**这里用户配置平台告警。**

### 前提条件

> * 需要设置告警的集群应该先在[【扩展组件】](addon-mgmt.md)安装**Prometheus组件**

### 操作步骤

#### 新建告警设置

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】下的【告警设置】，查看“告警设置”列表。
3. 选择相应【集群】，点击【新建】按钮。如下图所示：

   ![&#x65B0;&#x5EFA;&#x544A;&#x8B66;&#x6309;&#x94AE;](../../.gitbook/assets/新建告警按钮.png)

4. 在“新建策略”页面填写告警策略信息。如下图所示：

   ![&#x65B0;&#x5EFA;&#x544A;&#x8B66;&#x7B56;&#x7565;](../../.gitbook/assets/新建告警策略.png)

   * **告警策略名称：** 输入告警策略名称，最长60字符
   * **策略类型：** 选择告警策略应用类型
     * **集群：** 集群监控告警
     * **Pod：** Pod 监控告警
       * **告警对象：** 选择Pod相关的告警对象，支持对namespace下不同对deployment、stateful和daemonset 进行监控报警
         * **按工作负载选择：** 选择namespace下的某个工作负载
         * **全部选择：** 不区分namespace，全部监控
     * **节点：** 节点监控告警
   * **统计周期：** 选择数据采集周期，支持1、2、3、4、5分钟
   * **指标：** 选择告警指标，支持对监测值与指标值进行【大于/小于】比较，选择结果持续周期。如下图：

     ![&#x6307;&#x6807;&#x8BBE;&#x7F6E;](../../.gitbook/assets/指标设置.png)

   * **接收组：** 选择接收组，当出现满足条件当报警信息时，向组内人员发送消息。**接收组需要先在** [**通知设置**](monitor-alert.md#通知设置) **创建**
   * **通知方式：** 选择通知渠道和消息模版。**通知渠道 和 消息模版需要先在** [**通知设置**](monitor-alert.md#通知设置) **创建**
     * **添加通知方式** 如需要添加多种通知方式，点击该按钮。

5. 单击【提交】按钮。

   **复制告警设置**

6. 登录 TKEStack。
7. 切换至【平台管理】控制台，选择 【监控&告警】下的【告警设置】，查看“告警设置”列表。
8. 选择相应【集群】，点击告警设置列表最右侧的【复制】按钮。如下图所示：

   ![&#x544A;&#x8B66;&#x590D;&#x5236;&#x6309;&#x94AE;](../../.gitbook/assets/告警复制按钮.png)

9. 在“复制策略”页面，编辑告警策略信息。
10. 单击【提交】按钮。

    **编辑告警设置**

11. 登录TKEStack
12. 切换至【平台管理】控制台，选择 【监控&告警】下的【告警设置】，查看“告警设置”列表。
13. 选择相应【集群】，点击【告警名称】。如下图所示：

    ![&#x544A;&#x8B66;&#x540D;&#x79F0;](../../.gitbook/assets/告警名称.png)

14. 在“告警策略详情”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：

    ![&#x544A;&#x8B66;&#x7F16;&#x8F91;](../../.gitbook/assets/告警编辑.png)

15. 在“更新策略”页面，编辑策略信息。
16. 单击【提交】按钮。

    **删除告警设置**

17. 登录 TKEStack。
18. 切换至【平台管理】控制台，选择 【监控&告警】下的【告警设置】，查看“告警设置”列表。
19. 选择相应【集群】，点击列表最右侧的【删除】按钮。如下图所示：

    ![&#x544A;&#x8B66;&#x5220;&#x9664;](../../.gitbook/assets/告警删除.png)

20. 在弹出的删除告警窗口，单击【确定】按钮。

    **批量删除告警设置**

21. 登录TKEStack
22. 切换至【平台管理】控制台，选择 【监控&告警】下的【告警设置】，查看“告警设置”列表。
23. 选择相应【集群】，选择多个告警策略，单击告警设置下方的【删除】按钮。如下图所示：

    ![&#x6279;&#x91CF;&#x544A;&#x8B66;&#x5220;&#x9664;](../../.gitbook/assets/告警批量删除.png)

24. 在弹出的删除告警窗口，单击【确定】按钮。

## 通知设置

### 概念

**这里用户配置平台通知。**

### 操作步骤

#### 通知渠道

**新建通知渠道**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知渠道】，查看“通知渠道”列表。
3. 点击【新建】按钮。如下图所示：

   ![&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6E20;&#x9053;&#x6309;&#x94AE;](../../.gitbook/assets/xin-jian-tong-zhi-qu-dao-an-niu-%20%281%29.png)

4. 在“新建通知渠道”页面填写渠道信息。如下图所示： ![&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6E20;&#x9053;](../../.gitbook/assets/新建通知渠道%20%282%29.png)
   * **名称：** 填写渠道名称
   * **渠道：** 选择渠道类型，输入渠道信息
     * **邮件：** 邮件类型
       * **email：** 邮件发送放地址
       * **password：** 邮件发送方密码
       * **smtpHost：** smtp IP地址
       * **smtpPort：** smtp端口
       * **tls：**  是否tls加密
     * **短信：** 短信方式
       * **appKey：** 短信发送方的appKey
       * **sdkAppID：** sdkAppID
       * **extend：** extend 信息
     * **微信公众号：** 微信公众号方式
       * **appID：** 微信公众号appID
       * **appSecret：** 微信公众号app密钥
5. 单击【保存】按钮。

**编辑通知渠道**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知渠道】，查看“通知渠道”列表。
3. 单击渠道名称。如下图所示：

   ![&#x6E20;&#x9053;&#x540D;&#x79F0;](../../.gitbook/assets/qu-dao-ming-cheng-%20%281%29%20%281%29.png)

4. 在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：

   ![&#x6E20;&#x9053;&#x7F16;&#x8F91;&#x6309;&#x94AE;](../../.gitbook/assets/渠道编辑按钮%20%282%29%20%283%29.png)

5. 在“更新渠道通知”页面，编辑渠道信息。
6. 单击【保存】按钮。

**删除通知渠道**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知渠道】，查看“通知渠道”列表。
3. 选择要删除的渠道，点击【删除】按钮。如下图所示：

   ![&#x5220;&#x9664;&#x6E20;&#x9053;](../../.gitbook/assets/删除渠道.png)

4. 单击删除窗口的【确定】按钮。

#### 通知模板

**新建通知模版**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知模板】，查看“通知模板”列表。
3. 点击【新建】按钮。如下图所示：

   ![&#x65B0;&#x5EFA;&#x901A;&#x77E5;&#x6A21;&#x7248;](../../.gitbook/assets/xin-jian-tong-zhi-mo-ban-%20%281%29%20%281%29.png)

4. 在“新建通知模版”页面填写模版信息。如下图所示： ![&#x901A;&#x77E5;&#x6A21;&#x7248;](../../.gitbook/assets/通知模版%20%283%29.png)
5. **名称：** 模版名称
6. **渠道：** 选择已创建的渠道
7. **body：** 填写消息body体
8. **header：** 填写消息标题
9. 单击【保存】按钮。

**编辑通知模版**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知模板】，查看“通知模板”列表。
3. 单击模版名称。如下图所示：

   ![&#x6A21;&#x7248;&#x540D;&#x79F0;](../../.gitbook/assets/模版名称%20%281%29.png)

4. 在基本信息页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：

   ![&#x6A21;&#x7248;&#x7F16;&#x8F91;&#x6309;&#x94AE;](../../.gitbook/assets/模版编辑按钮%20%281%29%20%281%29.png)

5. 在“更新通知模版”页面，编辑模版信息。
6. 单击【保存】按钮。

**删除通知模版**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【通知模板】，查看"通知模板"列表。
3. 选择要删除的模版，点击【删除】按钮。如下图所示：

   ![&#x5220;&#x9664;&#x6A21;&#x7248;](../../.gitbook/assets/删除模版%20%281%29.png)

4. 单击删除窗口的【确定】按钮。

#### 接收人

**新建接收人**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收人】，查看"接收人"列表。
3. 点击【新建】按钮。如下图所示：

   ![&#x65B0;&#x5EFA;&#x63A5;&#x6536;&#x4EBA;](../../.gitbook/assets/xin-jian-jie-shou-ren-%20%281%29%20%282%29.png)

4. 在“新建接收人”页面填写模版信息。如下图所示： ![&#x63A5;&#x6536;&#x4EBA;](../../.gitbook/assets/接收人%20%281%29%20%281%29.png)
5. **显示名称：** 接收人显示名称
6. **用户名：** 接收人用户名
7. **移动电话：** 手机号
8. **电子邮件：** 接收人邮箱
9. **微信OpenID：** 接收人微信ID
10. 单击【保存】按钮。

**编辑接收人信息**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收人】，查看“接收人”列表。
3. 单击接收人名称。如下图所示：

   ![&#x63A5;&#x6536;&#x4EBA;&#x540D;&#x79F0;](../../.gitbook/assets/jie-shou-ren-ming-cheng-%20%281%29%20%281%29.png)

4. 在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：

   ![&#x63A5;&#x6536;&#x4EBA;&#x7F16;&#x8F91;&#x6309;&#x94AE;](../../.gitbook/assets/接收人编辑按钮%20%282%29.png)

5. 在“更新接收人”页面，编辑接收人信息。
6. 单击【保存】按钮。

**删除接收人**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收人】，查看“接收人”列表。
3. 选择要删除的接收人，点击【删除】按钮。如下图所示：

   ![&#x5220;&#x9664;&#x63A5;&#x6536;&#x4EBA;](../../.gitbook/assets/删除接收人.png)

4. 单击删除窗口的【确定】按钮。

#### 接收组

**新建接收组**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收组】，查看“接收组”列表。
3. 点击【新建】按钮。如下图所示：

   ![&#x65B0;&#x5EFA;&#x63A5;&#x6536;&#x7EC4;](../../.gitbook/assets/新建接收组%20%282%29%20%281%29.png)

4. 在“新建接收组”页面填写模版信息。如下图所示： ![&#x63A5;&#x6536;&#x7EC4;](../../.gitbook/assets/接收组.png)
   * **名称：** 接收组显示名称
   * **接收组：** 从列表里选择接收人。如没有想要的接收人，请在[接收人](monitor-alert.md#接收人)里创建。
5. 单击【保存】按钮。

**编辑接收组信息**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收组】，查看“接收组”列表。
3. 单击接收组名称。如下图所示：

   ![&#x63A5;&#x6536;&#x7EC4;&#x540D;&#x79F0;](../../.gitbook/assets/jie-shou-zu-ming-cheng-%20%281%29%20%282%29.png)

4. 在“基本信息”页面，单击【基本信息】右侧的【编辑】按钮。如下图所示：

   ![&#x63A5;&#x6536;&#x7EC4;&#x7F16;&#x8F91;&#x6309;&#x94AE;](../../.gitbook/assets/接收组编辑按钮%20%281%29%20%283%29.png)

5. 在“更新接收组”页面，编辑接收组信息。
6. 单击【保存】按钮。

**删除接收组**

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【通知设置】-&gt;【接收组】，查看“接收组”列表。
3. 选择要删除的接收组，点击【删除】按钮。如下图所示：

   ![&#x5220;&#x9664;&#x63A5;&#x6536;&#x7EC4;](../../.gitbook/assets/删除接收组%20%281%29%20%281%29.png)

4. 单击删除窗口的【确定】按钮。

## 告警记录

### 概念

**这里可以查看历史告警记录”**

### 操作步骤

1. 登录 TKEStack。
2. 切换至【平台管理】控制台，选择 【监控&告警】-&gt;【告警记录】查看“历史告警记录”列表。如下图所示：

   ![&#x5220;&#x9664;&#x63A5;&#x6536;&#x7EC4;](../../.gitbook/assets/告警记录.png)

